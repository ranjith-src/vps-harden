# VPS-Harden

> Idempotent VPS hardening for Ubuntu — SSH, firewall, fail2ban, kernel tuning, auditd, SOPS secrets, and optional AI agent workspace security. Dry-run first, lockout protection built in.

VPS-Harden is a single Bash script that secures a fresh or existing Ubuntu server. It runs 18 modules covering SSH hardening, firewall (UFW), fail2ban, kernel sysctl hardening, Netbird mesh VPN, SOPS+age secrets management, auditd monitoring, unattended upgrades, and AI agent workspace hardening.

Key properties:
- Idempotent: checks current state before every action, safe to re-run anytime
- Dry-run mode: preview every change before applying
- Lockout protection: validates sshd config, SSH keys, AllowUsers, and firewall rules before restarting — auto-rolls back on failure
- Interactive wizard: run `sudo vps-harden` with no args for guided setup with auto-detection
- Security scorecard: grouped verification output with section headers and next-steps guidance
- Zero dependencies: single Bash file, no Python, no Ansible, no agents

Install: `curl -fsSL https://raw.githubusercontent.com/ranjith-src/vps-harden/main/install.sh | bash`

## Documentation

- [README](https://github.com/ranjith-src/vps-harden/blob/main/README.md): Full parameter reference, module table, scorecard example, config file format
- [Getting Started Guide](https://github.com/ranjith-src/vps-harden/blob/main/docs/getting-started.md): Step-by-step onboarding from first SSH login to fully verified setup
- [Contributing](https://github.com/ranjith-src/vps-harden/blob/main/CONTRIBUTING.md): How to add modules, code style, ShellCheck requirements
- [Releases](https://github.com/ranjith-src/vps-harden/releases): Changelog for each version

## Modules

- prereqs: Installs foundation packages (curl, wget, jq, htop, ufw, fail2ban)
- user: Creates non-root user with sudo access, deploys SSH keys
- ssh: Disables root login, disables password auth, MaxAuthTries 3, AllowUsers, banner
- firewall: UFW default-deny incoming, allow outgoing, allow SSH
- fail2ban: 3 retries, 3h ban, UFW integration
- sysctl: SYN cookies, disable ICMP redirects/source routing, martian logging, RP filtering
- netbird: Installs Netbird mesh VPN, connects with setup key
- firewall_tighten: Allows VPN tunnel traffic, restricts SSH to safety IP, removes broad rules
- sops: Installs SOPS + age, generates encryption keypair
- upgrades: Enables unattended-upgrades, optional auto-reboot
- monitoring: Installs auditd + logwatch, deploys audit rules, installs server-report CLI
- shell: umask 027, bash history with timestamps, plaintext secret scanning
- misc: Timezone, hostname, lock root password, restrict su
- agent_secrets: Scans agent workspace for plaintext secrets, checks SOPS encryption (needs --agent-dir)
- agent_webhook_auth: Verifies webhook listener, UFW rules, TLS proxy, auth, rate limiting (needs --agent-dir)
- agent_logging: Creates log directory, logrotate, append-only flags, auditd rules (needs --agent-dir)
- agent_data: Checks data directory permissions, gitignore, git history, encryption (needs --agent-dir + --agent-data-dir)
- verify: Runs all checks, prints grouped security scorecard with next steps

## Agent Workspace Hardening

The last 4 modules are gated behind `--agent-dir DIR` and silently skip if not provided. They add zero-trust hardening for AI agent workloads (LLM bots, webhook receivers, health data pipelines).

Parameters:
- `--agent-dir DIR`: Agent workspace directory (required to enable agent modules)
- `--webhook-port PORT`: Webhook listener port (default: 5000)
- `--agent-data-dir DIR`: Sensitive data directory to protect (used by agent_data module)

## Optional

- [server-report](https://github.com/ranjith-src/vps-harden/blob/main/server-report): Companion CLI for quick VPS health checks (summary, auth, audit, full subcommands)
- [Config example](https://github.com/ranjith-src/vps-harden/blob/main/examples/config.env): Sample KEY=VALUE config file for repeatable setups
